/*
 * 汇智CMS日期选择器
 * 2017 by Cheng Yang
 * 895375958@qq.com
 * use HzTools
 */
!function(){"use strict";function t(){this.element="",this.static="",this.input="",this.selector="",this.dayok=!1,this.start=null,this.t={year:(new Date).getFullYear(),month:(new Date).getMonth()+1,day:(new Date).getDate(),hours:(new Date).getHours(),minute:(new Date).getMinutes(),second:(new Date).getSeconds()}}t.prototype.init=function(t,e,s){this.element=t,this.static=t.find(".input-static"),this.input=t.find("input"),this.selector=t.find(".date-selector"),void 0!==e&&(this.dayok=e),void 0!==s&&(this.start=new Date(s).getTime()),this.toggle(),this.setHtml(),this.show(),this.day(),this.selects()},t.prototype.show=function(){var t=this;t.selector.find(".year-name").click(function(){t.selector.find(".year_box").addClass("show"),t.year()}),t.selector.find(".month-name").click(function(){t.selector.find(".month_box").addClass("show"),t.month()}),t.selector.find(".hours").click(function(){t.selector.find(".hours_box").addClass("show"),t.hours()}),t.selector.find(".minute").click(function(){t.selector.find(".minute_box").addClass("show"),t.minute()}),t.selector.find(".second").click(function(){t.selector.find(".second_box").addClass("show"),t.second()})},t.prototype.setHtml=function(){var t;this.dayok?(this.selector.addClass("dayok"),t=""):t='<div class="bottom"><small class="hours">0</small><span>:</span><small class="minute">0</small><span>:</span><small class="second">0</small><div class="button confirm">确定</div><div class="button nowtime">此刻</div></div>',this.selector.append('<ul class="tab"><li class="year-prev">«</li><li class="month-prev">‹</li><li class="center"><span class="year-name">'+this.t.year+'年</span> <span class="month-name">'+this.t.month+'月</span></li><li class="year-next">»</li><li class="month-next">›</li></ul><ul class="week_box"><li>一</li><li>二</li><li>三</li><li>四</li><li>五</li><li>六</li><li>日</li></ul><dl class="day_box"></dl>'+t+'<div class="sonbox year_box"><ul class="tab"><li class="year-prev-s">«</li><li class="center">选择年</li><li class="year-next-s">»</li></ul><dl></dl></div><div class="sonbox month_box"><div class="title">选择月</div><dl></dl></div><div class="sonbox hours_box"><div class="title">选择时</div><dl></dl></div><div class="sonbox minute_box"><div class="title">选择分</div><dl></dl></div><div class="sonbox second_box"><div class="title">选择秒</div><dl></dl></div></div>')},t.prototype.toggle=function(){var t=this;if($(window).width()>=1024){var e=t.dayok?275:335;$(document).height()-t.element.offset().top<e&&t.selector.addClass("top")}else t.selector.addClass("mobile");this.static.click(function(e){t.selector.addClass("show"),$(document).one("click",function(){t.selector.removeClass("show")}),e.stopPropagation()}),this.selector.click(function(t){t.stopPropagation()})},t.prototype.selects=function(){var t=this;this.selectsDay(),t.selector.find(".year-prev").click(function(){t.t.year-=1,t.selector.find(".year-name").text(t.t.year+"年"),t.day()}),t.selector.find(".year-next").click(function(){t.t.year+=1,t.selector.find(".year-name").text(t.t.year+"年"),t.day()}),t.selector.find(".month-prev").click(function(){1==t.t.month?(t.t.month=12,t.t.year=t.t.year-1,t.selector.find(".year-name").text(t.t.year+"年")):t.t.month=t.t.month-1,t.selector.find(".month-name").text(t.t.month+"月"),t.day()}),t.selector.find(".month-next").click(function(){12==t.t.month?(t.t.month=1,t.t.year=t.t.year+1,t.selector.find(".year-name").text(t.t.year+"年")):t.t.month=t.t.month+1,t.selector.find(".month-name").text(t.t.month+"月"),t.day()}),t.selector.find(".nowtime").click(function(){var e=new Date;t.t.year=e.getFullYear(),t.t.month=e.getMonth()+1,t.t.day=e.getDate(),t.t.hours=e.getHours(),t.t.minute=e.getMinutes(),t.t.second=e.getSeconds(),t.returns()}),t.selector.find(".confirm").click(function(){t.t.hours=t.selector.find(".hours").text(),t.t.minute=t.selector.find(".minute").text(),t.t.second=t.selector.find(".second").text(),t.returns()})},t.prototype.selectsDay=function(){var t=this;t.selector.find(".day_box").off("click","dt"),t.selector.find(".day_box").off("click","dd"),t.selector.find(".day_box").on("click","dd",function(){if($(this).hasClass("disable"))return!1;t.t.day=parseInt($(this).text()),$(this).addClass("this"),$(this).siblings("dd").removeClass("this"),t.dayok&&t.returns()}),t.selector.find(".day_box").on("click","dt",function(){if($(this).hasClass("disable"))return!1;t.t.day=parseInt($(this).text()),t.t.month=parseInt($(this).attr("month")),t.t.year=parseInt($(this).attr("year")),t.selector.find(".year-name").text(t.t.year+"年"),t.selector.find(".month-name").text(t.t.month+"月"),$(this).siblings("dd").removeClass("this"),t.dayok?(t.day(),t.returns()):t.day()})},t.prototype.year=function(){var t=this;t.yearHtml(t.t.year);var e=t.t.year;t.selector.find(".year-prev-s").click(function(){e-=24,t.yearHtml(e)}),t.selector.find(".year-next-s").click(function(){e+=24,t.yearHtml(e)}),t.selector.find(".year_box").off("click","dd"),t.selector.find(".year_box").on("click","dd",function(){if($(this).hasClass("disable"))return!1;t.selector.find(".year_box").removeClass("show"),t.t.year=parseInt($(this).attr("data-id")),t.selector.find(".year-name").text(t.t.year+"年"),t.day()})},t.prototype.yearHtml=function(t){for(var e=this,s="",o=t-12;o<t+12;o++){var n=o+"/"+e.t.month+"/"+e.t.day;new Date(n).getTime()<e.start?s+='<dd class="disable" data-id="'+o+'">'+o+"</dd>":s+='<dd data-id="'+o+'">'+o+"</dd>"}e.selector.find(".year_box dl").html(s),e.selector.find(".year_box dl dd[data-id="+e.t.year+"]").addClass("this")},t.prototype.month=function(){for(var t=this,e="",s=1;s<13;s++){var o=t.t.year+"/"+s+"/"+t.t.day;new Date(o).getTime()<t.start?e+='<dd class="disable" data-id="'+s+'">'+s+"月</dd>":e+='<dd data-id="'+s+'">'+s+"月</dd>"}t.selector.find(".month_box dl").html(e),t.selector.find(".month_box dd[data-id="+t.t.month+"]").addClass("this"),t.selector.find(".month_box").off("click","dd"),t.selector.find(".month_box").on("click","dd",function(){if($(this).hasClass("disable"))return!1;t.selector.find(".month_box").removeClass("show"),t.t.month=parseInt($(this).attr("data-id")),t.selector.find(".month-name").text(t.t.month+"月"),t.day()})},t.prototype.day=function(){var t=this,e="",s=t.getDays(t.t.year,t.t.month),o=this.getDayWeek(t.t.year,t.t.month-1,1),n=t.prevMonthDays(t.t.year,t.t.month),i=t.nextMonthDays(t.t.year,t.t.month);if(0==o&&(o=7),o>1)for(var a=o-2;a>=0;a--){var d=n.year+"/"+n.month+"/"+(n.day-a);new Date(d).getTime()<t.start?e+='<dt class="disable" year="'+n.year+'" month="'+n.month+'">'+(n.day-a)+"</dt>":e+='<dt year="'+n.year+'" month="'+n.month+'">'+(n.day-a)+"</dt>"}for(a=1;a<=s;a++){d=t.t.year+"/"+t.t.month+"/"+a;new Date(d).getTime()<t.start?e+='<dd class="disable" data-id="'+a+'">'+a+"</dd>":e+='<dd data-id="'+a+'">'+a+"</dd>"}var r=42-s-o+1;for(a=1;a<=r;a++){d=i.year+"/"+i.month+"/"+a;new Date(d).getTime()<t.start?e+='<dt class="disable" year="'+i.year+'" month="'+i.month+'">'+a+"</dt>":e+='<dt year="'+i.year+'" month="'+i.month+'">'+a+"</dt>"}t.selector.find(".day_box").html(e),t.selector.find(".day_box dd[data-id="+t.t.day+"]").addClass("this")},t.prototype.hours=function(){for(var t=this,e="",s=0;s<24;s++)e+='<dd data-id="'+s+'">'+s+"</dd>";t.selector.find(".hours_box dl").html(e),t.selector.find(".hours_box").off("click","dd"),t.selector.find(".hours_box").on("click","dd",function(){t.selector.find(".hours_box").removeClass("show"),t.t.hours=parseInt($(this).attr("data-id")),t.selector.find(".hours").text(t.t.hours)})},t.prototype.minute=function(){for(var t=this,e="",s=0;s<60;s++)e+='<dd data-id="'+s+'">'+s+"</dd>";t.selector.find(".minute_box dl").html(e),t.selector.find(".minute_box").off("click","dd"),t.selector.find(".minute_box").on("click","dd",function(){t.selector.find(".minute_box").removeClass("show"),t.t.minute=parseInt($(this).attr("data-id")),t.selector.find(".minute").text(t.t.minute)})},t.prototype.second=function(){for(var t=this,e="",s=0;s<60;s++)e+='<dd data-id="'+s+'">'+s+"</dd>";t.selector.find(".second_box dl").html(e),t.selector.find(".second_box").off("click","dd"),t.selector.find(".second_box").on("click","dd",function(){t.selector.find(".second_box").removeClass("show"),t.t.second=parseInt($(this).attr("data-id")),t.selector.find(".second").text(t.t.second)})},t.prototype.prevMonthDays=function(t,e){return 1==e&&(t-=1,e=13),{year:t,month:e-1,day:this.getDays(t,e-1)}},t.prototype.nextMonthDays=function(t,e){return 12==e&&(t+=1,e=0),{year:t,month:e+1,day:this.getDays(t,e+1)}},t.prototype.returns=function(){var t=this,e=t.t.year+"-"+t.inZero(t.t.month)+"-"+t.inZero(t.t.day);t.selector.removeClass("show"),t.dayok||(e+=" "+t.inZero(t.t.hours)+":"+t.inZero(t.t.minute)+":"+t.inZero(t.t.second)),t.static.text(e).addClass("selected"),t.input.val(e)},t.prototype.inZero=function(t){return t<10?"0"+t:t},t.prototype.getDays=function(t,e){return new Date(t,e,0).getDate()},t.prototype.getDayWeek=function(t,e,s){return new Date(t,e,s).getDay()},window.HzDateSelector={init:function(e,s,o){$(e).each(function(){(new t).init($(this),s,o)})}}}();